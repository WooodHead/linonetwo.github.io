---
layout: post
title: "前端插件系统设计"
date: 2017-08-21 20:43:19 +0800
image: 'blog-author.jpg'
description: '综述常见的插件化架构'
main-class: 'frontend'
color: '#66CCFF'
tags:
- system
- meme
- WIP
categories: Review
twitter_text:
introduction: '要充分利用社区的力量，就必须为应用开发插件系统，本文综述了目前比较流行的插件系统架构'
---
# 前端插件系统设计

每个用户都有自己的个性，他们会想看到你的应用有不同的主题、会想用自己喜欢的方式输入信息、会想要你的应用支持他偏门的用法。这些其实都不是问题，只要你提供了友好的插件（plugin or extension）系统，总会有能人志士做出贡献，写出牛逼的插件。

Atom 是一个用起来比较卡的，完全插件化的好看的文本编辑器，它安装后提供的功能是以 77 个官方插件的形式存在的。比如其中的 autocomplete 官方插件，因为不够好用，后来被社区大受好评的 autocomplete-plus 插件替换掉了，所以插件系统就非常民主。[[1]](#1)

我们在设计前端应用时如果提早考虑到插件架构，能为我们的应用带来很大的社区活跃性。

## Semantic Media Wiki

用于构建 DBPedia 的维基百科，是使用一款叫 Media Wiki 的程序架设的。
  
Media Wiki 广泛用于各种维基站点，但它有一个缺点，就是没法细粒度地把百科页面语义化。维基百科每个页面就是一堆 HTML，当你有数百万个页面时，想找到某个实体就只能用信息检索（IR）的方法。当维基系统被 Semantic Media Wiki 插件接管，你就能通过搜索性别、年龄、职业来查找实体，就像使用一个数据库一样。[[2]](#2)
  
Semantic Media Wiki 作为 Media Wiki 的大型扩展插件集（expansion），在 Media Wiki 的框架上提供了很复杂的结构化数据、查询数据等功能，例如可以把维基内容变成图表、时间轴、地图等形式来展现。而它自身又可攻可受，自己是别人的插件，然后又提供了插件系统给别人。
  
例如 SMW 的插件 SemanticResultFormat 就可以丰富 query 结果的格式；SemanticForms 通过表单编辑（新的编辑方式）结合SMW进行操作，增强了「录入属性」这一部分，同时为 SMW 使用者提供了一个非常强大的函数 ```{{#arraymap}}```；Arrays 插件则为使用者提供了 ```{{#arraydefine}}``` 和 ```{{#arrayprint}}``` 两个函数。所以说 Semantic Media Wiki 是一个凸和凹的结合体，「鼎」是也。[[4]](#4)

## Load

我们一般会把第三方插件下载到文件系统上，放在名叫 /plugin 之类的文件夹里。
  
火狐狸浏览器的插件是 .xpi 文件，其实就是个 zip 包，下载到火狐存放插件的文件夹里之后，我们在内存里解压它，加载里面的脚本。一般来说这种直接把打好的包放进某个文件夹就能用的方式对使用者会比较友好，但系统设计会比较复杂。而且虽然简化掉了解压到文件系统的过程，但每次还是得在内存里解压读取内容。[[3]](#3)
  
读取压缩包的好处是不用读取大量零碎文件。Atom 曾经为读取 node_modules 中数以万计的零碎小文件太慢而发愁，最后选择了读取 Electron 提供的 ASAR 归档格式，一次性读取海量小文件打包成的一个大文件。[[2]](#2)



## 参考

### [<span id="1">Atom 背后的故事</span>](https://zhuanlan.zhihu.com/p/23536047)

### [<span id="2">如何理解semantic mediawiki插件的用途？</span>](https://www.zhihu.com/question/20753047)

### [<span id="3">python 插件系统</span>](http://hgoldfish.com/blogs/article/81/)

### [<span id="4">帮助:Semantic Mediawiki</span>](http://www.huijiwiki.com/wiki/%E5%B8%AE%E5%8A%A9:Semantic_Mediawiki)


Demo 项目地址：[itonnote](https://github.com/linonetwo/itonnote)
