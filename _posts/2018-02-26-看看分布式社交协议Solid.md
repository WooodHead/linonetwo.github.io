---
layout: post
title: "来看看分布式社交协议栈Solid"
date: 2018-02-26 22:40:19 +0800
image: 'blog-author.jpg'
description: 'Solid 是 Tim Berners-Lee 带队做的分布式社交网络项目'
main-class: 'frontend'
color: '#827717'
tags:
- knowledgeGraph
- WIP
categories: Journal
twitter_text:
introduction: '让互联网重新去中心化的项目之一'
---
# 看看分布式社交协议栈 Solid

Solid 是 social linked data (社交互联数据) 的缩写，简单来介绍就是一个规范，按着它来的话我们可以把现在分散在微信朋友圈、微博、推特等等产品上的自己几十个账号内的数据都保存到一个地方，存到你自己想存的存储空间里，而不是疼讯、新浪、国外不存在公司的服务器上。而且你发一条微博之后还可以一键同步到朋友圈。

做到这些事情的关键是数据与应用分离，这一点 Tim 在他的 Design Issue 里早就深思熟虑过了[[2]](#2) ，如果让用户拥有他生产出来的数据，而不是现在这样由巨头公司存在它们的中心化服务器里，我们可以：

1. 永远拥有我们的数据，不怕倒闭不怕墙；
1. 让多个应用的数据互联，你在《时间块》里生产的数据能零成本地用来发微博；
1. 鼓励社区创新出更多 Web 应用，因为不再需要冷启动了，新的应用可以直接授权使用你的现有数据；
1. 让应用和数据拥有不同的生命周期，比如用一直存在的微信应用来生产只需要存在一周的闲聊，或者用一个只需要存在一周的企业级小工具生产和这个企业永远相伴的重要数据。

总之，这些想法早就已经存在，现在 Tim 开始行动了，Solid 协议栈不是一个全新的东西，它是很多现有的 W3C 规范的合集，以一种有机的方式结合起来。除了给出一套规范以外，Solid 还提供了很多 js 工具，比如 [solid-client](https://npm.runkit.com/solid-client) 就让我们能方便地用规范的方式登录账号、存储数据，[solid server](https://github.com/solid/node-solid-server) 就是一个参考的服务端实现。

已经有一些原型应用围绕这套规范建立，比如在线文本编辑器 [dokieli](https://dokie.li/docs) 、 RDF 数据存储 [databox](https://databox.me/) 等，这些开源应用都可以被社区拿来参考。

本文介绍 Solid 协议栈涉及到的各种概念，以及我们能如何用以太坊、IPFS 等新的分布式应用基础设施来实现 Solid 应用，光复去中心化的民主互联网。

## 分布式身份

```https://linonetwo.databox.me/profile/card#me``` 是我的 WebID，你可以试着用它在 [试验场](https://solid.github.io/solid-client/demo/) 登录，看看各种操作会返回什么。

WebID 是我们登录使用 Solid 应用的用户名，同时也兼具密码的功能。而且这个 WebID 可以用于登录所有基于 Solid 技术栈的应用，现在用支付宝账号能登录所有阿里系的应用、用微信账号登录所有疼讯系的应用，以后一个 WebID 就能登录所有这些应用。

使用 WebID 登录 Solid 应用意味着授权这个应用读取你的头像、工作单位等等基本信息，这些信息都是用 RDF 语言写的，但是可以用不同的方言语法来书写，也可以用各种编辑器来填写。我的 WebID 里用的是 w3c 推荐的 [turtle](https://www.w3.org/2005/Incubator/webid/spec/identity/#bib-turtle) 语法，它是 RDF 的一种。Turtle 和 JSON-LD 是 RDF 的两种优化版本 [[13]](#13) ，对于个人主页的拥有者来说，它们比较好写，对于编写能自动访问个人主页的程序的程序员来说，它们又很好读。

登录应用后这个应用根据你的数据，为你提供不同的服务，比如根据你的工作地点自动设置好送外卖的地址。站在前端应用开发者的角度来看，开发新应用的成本会变小，因为在 Solid 技术栈下使用用户数据总是有相同的体验，不需要每次都了解一遍新的后端 API，拿到的数据用的都是 [FOAF](https://www.w3.org/2005/Incubator/webid/spec/identity/#bib-FOAF) 这样的标准词典。

### WebID 的意义

```https://linonetwo.databox.me/profile/card#me``` 中井号前的部分 ```https://linonetwo.databox.me/profile/card``` 是一个个人信息页面，加上 ```#me``` 其实返回的信息差不多，但是语义上不带井号的 URI 意思就是一个个人信息页面，加上 ```#me``` 或者 ```#i``` 的就是一个名字的感觉，指的是我这个人，所以登录各种应用的时候不应该是给应用我的个人页面 ```https://linonetwo.databox.me/profile/card```，而应该给它我的名字，也就是 ```https://linonetwo.databox.me/profile/card#me``` [[5]](#5)。

那么 ```https://linonetwo.databox.me/profile/card``` 这个页面上有很多我的个人信息，比如我认识的人，我的女朋友是谁，但我可能不想让人知道我老家是厦门，想只让几个我知道是我老乡的人能使用我的家乡信息，也就是我要做权限控制。这个可以使用 [WebAccessControl](https://www.w3.org/wiki/WebAccessControl) 来做，在我的个人页面上引用存着我家乡信息的文件，但是那个文件上加了一个权限列表（ACL），这样就解决了公开信息的隐私问题。实际应用中，你在各种应用里的设置、个人偏好都会放到仅私人权限可见的分组里，以防闲人看到你用过哪些应用，在应用里有什么奇奇怪怪的偏好 [[6]](#6)。从开发者的角度来看，Solid 也会引导你找到你可以存储数据的地方，因此你不需要遍历用户的所有数据来找你存储的数据，或者其他你关心的数据 [[7]](#7)。

那如果别人用我的 WebID 去某个论坛上发言怎么办呢？这时候第一是靠 HTTPS，第二是靠数字证书，然后在它们的基础上再做进一步的身份验证。

### 身份认证

我们知道以太坊钱包它不需要你提供一个密码，因为没有一个中心服务器给你存密码，以太坊的身份校验是通过公钥和私钥。
WebID 也很类似，我们首先要生成一份公钥放在我们的页面上（放在 ```https://linonetwo.databox.me/profile/card``` 里），然后把配套的私钥存在浏览器里（或者一个专用的密码管理器，类似于 MetaMask，或者一个冷钱包），接着当你打开一个有一定权限管理的程序的时候，如下图的事情就会发生：

![验证身份](https://www.w3.org/2005/Incubator/webid/spec/tls/img/WebIDSequence-friendly.png)

1. 鲍博士的浏览器和爱丽丝的服务器建立 HTTPS 连接；
1. 鲍博士的浏览器发出一个 REST 请求，去请求某个数据；
1. 权限控制网关这时候就会先检查一下这个数据有没有加访问权限，如果它就是个公开数据，那就直接返回给鲍博士。但很可惜这是一份机密的情书，所以只有通过权限检验的人才能看到。
1. 那这时候爱丽丝的服务器就要进行权限检验了，第一步就是确认此时请求文件的人就是鲍博士本人。那爱丽丝的服务器就请鲍博士的浏览器发送一个证书，上面带着鲍博的 WebID 和公钥，这时候鲍博的浏览器就会弹一个框上面可能有鲍博的大号和小号，让他点击选一个账号，这个 WebID 就带着相应的公钥填进证书里，点完之后这个证书就会用鲍博浏览器上（或者一个专用的密码管理器里）的私钥签名 [[9]](#9) 之后，发给爱丽丝的服务器；
1. 爱丽丝的服务器满意地收到了证书，把证书交给权限校验程序（黄色的框）；
1. 校验程序就拿证书里填的 WebID 去访问一下，取鲍博的个人信息，然后因为 WebID 就是一个 URI，指向鲍博自己搭的服务器上的个人信息页面，所以访问一下就能拿到个人信息；
1. 校验程序拿着信息一比对，感觉这个发证书的鲍博应该就是 WebID 所说的那个鲍博，那就可以拿这个身份去跑一下权限检验看他能不能读这个数据 [[11]](#11)，比如必须鲍博必须要在爱丽丝的社交图谱中是比较核心的朋友才能通过这个文件的校验 [[8]](#8)；
1. 鲍博通过了校验，他之前的那个请求数据的 REST 请求返回了相应的数据。

### 对比

总结一下，使用现在的古典互联网应用时，我们需要用用户名密码来登录，但是使用 WebID 的时候我们只需要点击一下我们想要使用的账户，并不需要输入密码。

当我们使用另一台电脑的时候，古典互联网应用允许我们继续使用同样的用户名密码，但是 Solid 技术栈应用就要求我们像使用基于以太坊的应用一样，先把私钥同步过去，才能一劳永逸地登录（这里说的是 WebID-TLS 方案，当然，其实也有其他更便捷的临时方法来登录，比如 [WebID-OIDC 方案](https://github.com/solid/solid-spec#webid-oidc)）。

最后，Solid 技术栈的应用会有更丰富的权限管理机制，这对于内容发布者来说自然是一件好事，如果和加密货币结合起来，在权限检查的时候不是检查社交关系而是去检查某个智能合约的结果，那可能就是内容付费的新路子。当然，这可能超出了 WebACL 的支持范围 [[10]](#10)。

## 数据存储

使用 WebID 登录要求每个人都有一个公开在网页上的个人页面，在校验身份的时候，你访问的服务器会去访问你的个人页面。那么不懂互联网技术、没有购买自己的服务器的人要怎么拥有个人页面呢？

Solid 在存储方面使用了 Linked Data Platform 规范 [[12]](#12)，只要能遵循这个规范用 REST 请求来请求数据、增删数据的存储服务就可以用作 Solid 应用的存储空间。

这个服务可以是一个中心化的云盘，比如用现在 demo 性质的 [databox](https://databox.me/) 服务就可以一键创建一个你自己的 LDP（Linked Data Platform），而且自动帮你创建个人信息页面。

未来，我们也可以选择其他去中心化存储空间，比如以太坊或 IPFS，并在其上用 serverless 的方式做权限验证、数据增删，从而彻底告别中心化服务器。对非技术人员来说，好处是不用再去购买、架设服务器了，只需要用加密货币支付存储费用，然后一键生成自己的 LDP 服务即可。

### LDP 数据构成

被应用放在 LDP 上的最重要的数据是互联数据，比如 [turtle 三元组语言描述的个人信息页](https://linonetwo.databox.me/profile/card)，背后是[这样的](view-source:https://linonetwo.databox.me/Preferences/prefs.ttl)。在 databox 上的互联数据可以用任何版本的 RDF 来书写，一般是 turtle，你也可以用 JSON-LD。

那为什么要放互联数据呢？如下图可见，容器直接标明了里面的两个文件的类型是 ```p:product``` ，因此任何访问这个容器的自动程序都能理解这个容器是用来放某种产品的，这种程序的理解能力不需要高深的人工智能，但是对用户来说它的这种理解能力就是很智能。所以通过添加互联数据我们几乎零成本地就能做出一大堆「人工智能」应用。

![Using domain vocabularly with a Direct container](https://www.w3.org/TR/ldp-primer/dc1.png)

还有一种常见数据就是图片、文档、PPT、程序安装包之类的任意类型的东西，你能往网盘里存什么，就能往 LDP 里放什么。比如上图中的两个 Product Resource 可能就是新旧两个版本的色情游戏软件安装包，新版中为了维护和谐社会给所有东西都打了码，而原版中如下图可见，所有东西都没打码。

[图片]

最后，还有一种关键的资源，就是用来放上述资源的资源，LDPC（Linked Data Platform Container）也就是互联数据平台容器，像一个文件夹，但它不能是单纯的存储东西的文件夹，还得能响应 REST 请求，从而在文件夹里创建新的互联数据、图片、文档。[例如](https://www.w3.org/TR/ldp-primer/#docstore) 通过 PUT 方法来大量更新文档内容，PATCH 方法来增量更新文档内容，DELETE 方法来删除文档。

如果只是存储文档供其他人读取的话，我们可以很容易地用 IPFS 之类的分布式存储来实现，因为它们只需要实现 GET 方法。但 LDPC 这种需要 PUT 等方法的容器，就不止需要分布式存储，还需要有服务器来处理收到请求后的逻辑。如果在容器里 GET 数据的时候需要进行权限检验的话，那操作容器里的所有文件都会需要服务器的支持。

### DAPP 与 DData

任何一个中心化的数据存储提供方都可能会吞掉我们的数据，比如百度贴吧会肆意删掉几百页的帖子、新浪爱问知识人会被整个关闭、百度云里的葫芦娃视频会变成 8 秒的净网行动视频。

在 Solid 之外，我们其实已经有用于编写分布式互联网应用的技术栈，例如以太坊。我们也有分布式地存储数据的技术栈，例如 IPFS。而因为互联网应用本身就是数据，所以上述两个技术栈可以交换着用，例如 [vue-ethereum-ipfs](https://github.com/redacademy/vue-ethereum-ipfs) 就是用以太坊来存储数据，用 IPFS 来发送 HTML 和 JS 书写的互联网应用。

## 参考

- [<span id="1">1.官网</span>](https://solid.mit.edu/)
- [<span id="2">2.关于数据应用分离的 Design Issue</span>](https://www.w3.org/DesignIssues/CloudStorage.html)
- [<span id="3">3.规范文档</span>](https://github.com/solid/solid-spec)
- [<span id="4">4.开发者教程</span>](https://github.com/solid/solid-tutorial-intro)
- [<span id="5">5.如何用 URI 指代事体</span>](https://www.w3.org/TR/cooluris/#solutions)
- [<span id="6">6.WebID 私人信息</span>](https://github.com/solid/solid-spec/blob/master/solid-webid-profiles.md#public-and-private-profiles)
- [<span id="7">7.应用数据引导</span>](https://github.com/solid/solid/blob/master/proposals/data-discovery.md)
- [<span id="8">8.Web访问权限控制（写得很模糊）</span>](https://www.w3.org/wiki/WebAccessControl)
- [<span id="9">9.图解数字签名（中文）</span>](http://www.ruanyifeng.com/blog/2011/08/what_is_a_digital_signature.html)
- [<span id="10">10.WebACL 能做啥（中文）</span>](https://docs.aws.amazon.com/zh_cn/waf/latest/developerguide/web-acl.html)
- [<span id="11">11.WAC 的几种权限</span>](https://github.com/solid/web-access-control-spec#modes-of-access)
- [<span id="12">12.互联数据存储平台介绍</span>](https://www.w3.org/TR/ldp-primer/#intro-section)
- [<span id="13">13.Turtle 与 JSON-LD 的互联数据比较</span>](https://www.w3.org/2013/dwbp/wiki/RDF_AND_JSON-LD_UseCases)
